<h1>My Cases</h1>

  <% if current_user.is_broker? %>
    <%= form_tag '', :method => :get do %>
      <%= select_tag :active, options_for_select([["Open", true], ["Closed", false]]), :prompt => 'Select One' %>
      <%= select_tag :status, options_for_select([ 'setup', 'dip', 'full application', 'valuation', 'offer', 'exchanged', 'completed' ]), :prompt => 'Select One'  %>
      <%= submit_tag 'Filter' %>
    <% end %>
  <% end -%>

  <table>
    <thead>
      <tr>
        <th>Opened</th>
        <th>Status</th>
        <th>Type</th>
        <th>Lender</th>
        <% if current_user.is_broker? %>
          <th>Applicant</th>
        <% end  %>
        <th>Progress</th>
        <th>Mortgage</th>
        <th>Valuation</th>
        <th>Last update</th>
        <th></th>
      </tr>
    </thead>

    <tbody>
      <% @application_cases.each do |application_case| %>
        <tr class="<%= cycle('even', 'odd') -%>">
          <td><%= application_case.created_at.to_formatted_s(:short) %></td>
          <td><% if application_case.active %>Open<% else %>closed<% end %></td>
          <td><%= application_case.app_type %></td>
          <td><%= application_case.lender.name %></td>
          <% if current_user.is_broker? %>
            <td class='links'>
              <% if application_case.has_applicants?  %>
                <% application_case.users.clients.each do |applicant| %>
                  <%= link_to applicant do %>
                    <%= applicant.contact.fname %> <%= applicant.contact.lname %>
                  <% end %>
                <% end %>
              <% end %>
            </td>
          <% end %>
          <td><%= application_case.status %></td>
          <td><%= number_to_currency_gbp(application_case.mortgage) %></td>
          <td><%= number_to_currency_gbp(application_case.valuation) %></td>
          <td><%= application_case.updated_at.to_formatted_s(:short) %></td>
          <td class="actions">
                <%= link_to application_case do %><i class="fa fa-eye fa-2x"></i><% end %>
                <% if can? :update, application_case %>
                  <%= link_to edit_application_case_path(application_case) do %><i class="fa fa-cog fa-2x"></i><% end %>
                <% end %>
                <% if can? :delete, application_case %>
                  <%= link_to application_case, method: :delete, data: { confirm: 'Are you sure?' } do %><i class="fa fa-times fa-2x"></i><% end %>
                <% end %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
  <br>
